name: Build & Release Universal macOS App

on:
  push:
    tags:
      - 'v*'   # æ¨é€ tag æ—¶è§¦å‘
  workflow_dispatch:  # ä¹Ÿæ”¯æŒæ‰‹åŠ¨è§¦å‘

jobs:
  build:
    runs-on: macos-latest

    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: è®¾ç½® Xcode ä¸ºé»˜è®¤ç‰ˆæœ¬ï¼ˆXcode.appï¼Œç®€æ´ç¨³å®šï¼‰
        run: |
          sudo xcode-select -s /Applications/Xcode.app

      - name: éªŒè¯ Xcode ç‰ˆæœ¬
        run: |
          xcode-select -p
          xcodebuild -version

      - name: ğŸ” æ’æŸ¥æ£€å‡ºä»£ç çš„æ–‡ä»¶ç»“æ„ï¼ˆå…³é”®ï¼æ‰¾åˆ°.xcodeprojçš„å®é™…è·¯å¾„ï¼‰
        run: |
          # æŸ¥çœ‹å½“å‰å·¥ä½œç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹
          ls -la
          # é€’å½’æŸ¥æ‰¾æ‰€æœ‰.xcodeprojæ–‡ä»¶ï¼Œæ˜¾ç¤ºå…¶å®Œæ•´è·¯å¾„
          find . -name "*.xcodeproj" -type d

      - name: æ„å»ºé€šç”¨æ¶æ„ .appï¼ˆä½¿ç”¨å®é™…é¡¹ç›®åç§°JeffernMovieï¼Œç¡®ä¿æ„å»ºæˆåŠŸï¼‰
        run: |
          # è‹¥findå‘½ä»¤æŸ¥åˆ°é¡¹ç›®åœ¨å­æ–‡ä»¶å¤¹ï¼Œæ·»åŠ  cd ./å­æ–‡ä»¶å¤¹ åˆ‡æ¢ç›®å½•ï¼ˆç¤ºä¾‹ï¼šcd ./MyAppï¼‰
          xcodebuild -project JeffernMovie.xcodeproj \
            -scheme JeffernMovie \
            -configuration Release \
            -arch x86_64 -arch arm64 \
            -derivedDataPath build \
            clean build

      - name: æ‰“åŒ… .app ä¸º zipï¼ˆè¾“å‡ºæ–‡ä»¶åæ”¹ä¸ºJoyflixï¼‰
        run: |
          cd build/Build/Products/Release
          # æ ¸å¿ƒä¿®æ”¹ï¼šè¾“å…¥æ˜¯å®é™…æ„å»ºå‡ºçš„JeffernMovie.appï¼Œè¾“å‡ºæ”¹ä¸ºJoyflix.app.zip
          zip -r Joyflix.app.zip JeffernMovie.app

      - name: ä¸Šä¼ åˆ° GitHub Releasesï¼ˆä¸Šä¼ ä¿®æ”¹åçš„Joyflix.app.zipï¼‰
        uses: softprops/action-gh-release@v2
        with:
          files: build/Build/Products/Release/Joyflix.app.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
